{% extends 'base.html' %}
{% load static %}

{% block sidebar_content %}



</li>
<li class="separator"></li>
<li>
    <a href="{% url 'logout' %}">
        <img src="{% static 'icons/logout.svg' %}" alt="">
        <span>Cerrar Sesión</span>
    </a>
</li>
{% endblock %}

{% block content %}
<h1 style="color: var(--color-principal); margin-bottom: 1.5rem;">
    Detalle de Incidencia #{{ solicitud.id }}
</h1>

<!-- Tarjeta principal -->
<div class="card" style="margin-bottom: 1.5rem;">
    <div class="card-header">
        <h2 style="margin: 0; color: var(--color-principal);">
            {{ solicitud.encuesta_base.titulo_encuesta }}
        </h2>
    </div>
    <div class="card-body" style="line-height: 1.6;">
        <p><strong>Estado:</strong>
            {% if solicitud.estado == 'abierta' %}
                <span class="badge badge-info">Abierta</span>
            {% elif solicitud.estado == 'derivada' %}
                <span class="badge badge-warning">Derivada</span>
            {% elif solicitud.estado == 'rechazada' %}
                <span class="badge badge-danger">Rechazada</span>
            {% elif solicitud.estado == 'finalizada' %}
                <span class="badge badge-success">Finalizada</span>
            {% endif %}
        </p>

        <p><strong>Creada el:</strong> {{ solicitud.creado|date:"d/m/Y H:i" }}</p>
        <p><strong>Ubicación:</strong> {{ solicitud.ubicacion|default:"No especificada" }}</p>

        <p><strong>Departamento asignado:</strong>
            {% if solicitud.departamento_asignado %}
                {{ solicitud.departamento_asignado.nombre_departamento }}
            {% else %}
                <span class="text-muted">Sin asignar</span>
            {% endif %}
        </p>

        <p><strong>Dirección asignada:</strong>
            {% if solicitud.direccion_asignada %}
                {{ solicitud.direccion_asignada.nombre_direccion }}
            {% else %}
                <span class="text-muted">Sin asignar</span>
            {% endif %}
        </p>

        <p>
    <strong>Prioridad:</strong>
    {% with p=solicitud.encuesta_base.get_prioridad_display|default:solicitud.encuesta_base.prioridad %}
        {% if p and p|lower == 'alta' %}
            <span class="badge badge-danger">Alta</span>
        {% elif p and p|lower == 'media' %}
            <span class="badge badge-warning">Media</span>
        {% else %}
            <span class="badge badge-secondary">Baja</span>
        {% endif %}
    {% endwith %}
</p>


        {% if solicitud.descripcion_resolucion %}
            <div style="margin-top: 1rem;">
                <p><strong>Resolución registrada por cuadrilla:</strong></p>
                <p style="background: #f8f9fa; border-left: 4px solid var(--color-principal);
                          padding: 0.75rem 1rem; border-radius: 0.25rem;">
                    {{ solicitud.descripcion_resolucion }}
                </p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Tarjeta con tabla -->
<div class="card">
    <div class="card-header">
        <h2 style="margin: 0; color: var(--color-principal);">
            Respuestas de la Encuesta
        </h2>
    </div>
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th style="width: 60%;">Pregunta</th>
                    <th style="width: 40%;">Respuesta</th>
                </tr>
            </thead>
            <tbody>
                {% for r in respuestas %}
                    <tr>
                        <td>{{ r.pregunta.texto_pregunta }}</td>
                        <td>{{ r.respuesta_texto }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="2" class="text-center text-muted">
                            No hay respuestas asociadas a esta incidencia.
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="text-right" style="margin-top: 1.5rem;">
    {% if desde == 'cuadrilla' %}
        <a href="{% url 'dashboard_cuadrilla' %}" class="btn btn-primary">
            ← Volver al Dashboard
        </a>
    {% elif desde == 'territorial' %}
        <a href="{% url 'dashboard_territorial' %}" class="btn btn-primary">
            ← Volver al Dashboard
        </a>
    {% elif desde == 'departamento' %}
        <a href="{% url 'dashboard_departamento' %}" class="btn btn-primary">
            ← Volver al Dashboard
        </a>
    {% else %}
        <a href="{% url 'dashboard_main' %}" class="btn btn-primary">
            ← Volver al Dashboard
        </a>
    {% endif %}
</div>


{% endblock %}

{% block extra_css %}
<style>
    .card {
        background: #fff;
        border-radius: 0.6rem;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--border-color);
    }
    .card-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        background-color: #f9fafb;
    }
    .card-body {
        padding: 1.5rem;
        color: var(--text-color);
    }

    .table-container {
        overflow-x: auto;
    }
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    .data-table th,
    .data-table td {
        padding: 0.9rem 1rem;
        border-bottom: 1px solid var(--border-color);
        text-align: left;
        vertical-align: top;
    }
    .data-table th {
        background-color: var(--fondo-general);
        font-weight: 700;
        color: var(--color-principal);
    }
    .data-table tr:last-child td {
        border-bottom: none;
    }

    .btn-primary {
        background-color: var(--color-principal);
        border: none;
        color: white;
        border-radius: 0.4rem;
        text-decoration: none;
        transition: background-color 0.2s ease;
    }
    .btn-primary:hover {
        background-color: #1a73e8;
    }

    .badge {
        display: inline-block;
        padding: 0.35em 0.65em;
        font-size: 0.8rem;
        font-weight: 600;
        border-radius: 0.4rem;
        color: white;
    }
    .badge-info { background-color: #17a2b8; }
    .badge-warning { background-color: #ffc107; color: #212529; }
    .badge-danger { background-color: #dc3545; }
    .badge-success { background-color: #28a745; }
</style>
{% endblock %}
